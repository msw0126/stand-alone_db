function setLeftMenu(){var e="";$(".leftMenu li").draggable({helper:"clone",scope:"plant"}),$("#container").droppable({scope:"plant",drop:function(t,a){e=Math.uuid(32,16),CreateModel(a,$(this),e),instance.repaintEverything()}})}function CreateModel(e,t,a){var o=$(e.draggable).attr("id"),i=o+"_model_"+modelCounter++,n=$(e.draggable).attr("type");"reader"==n?$(t).append('<div class="reader model jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" compid= "'+a+'" id="'+i+'" modelType="'+n+'" souid=""><img class="content-img" src="img/type.service.png" /><span class="content-text">CSV 读取</span><div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>'):"robotx"==n?$(t).append('<div class="robotx model jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" compid= "'+a+'" id="'+i+'" modelType="'+n+'" souid=""><img class="content-img" src="img/type.business.rule.png" /><span class="content-text">RobotX</span><div class="proess_bj" style="display:none;"><div class="proess" style="display:none;"><label>执行中</label><div class="proess-show-go"></div></div><div class="proesss" style="display:none;"><div class="proess-show-ok"></div></div></div><div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>'):"learn"==n?$(t).append('<div class="learn model jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" compid= "'+a+'" id="'+i+'" modelType="'+n+'" souid="" ><img class="content-img" src="img/type.learn.png" /><span class="content-text">Atom-learn</span><div class="proess_bj" style="display:none;"><div class="proess" style="display:none;"><label>执行中</label><div class="proess-show-go"></div></div><div class="proesss" style="display:none;"><div class="proess-show-ok"></div></div></div><div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>'):"act"==n?$(t).append('<div class="act model jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" compid= "'+a+'" id="'+i+'" modelType="'+n+'" souid=""><img class="content-img" src="img/type.act.png" /><span class="content-text">Atom-act</span><div class="proess_bj" style="display:none;"><div class="proess" style="display:none;"><label>执行中</label><div class="proess-show-go"></div></div><div class="proesss" style="display:none;"><div class="proess-show-ok"></div></div></div><div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>'):"test"==n?$(t).append('<div class="test model jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" compid= "'+a+'" id="'+i+'" modelType="'+n+'" souid=""><img class="content-img" src="img/type.test.png" /><span class="content-text">Atom-test</span><div class="proess_bj" style="display:none;"><div class="proess" style="display:none;"><label>执行中</label><div class="proess-show-go"></div></div><div class="proesss" style="display:none;"><div class="proess-show-ok"></div></div></div><div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>'):"pmml"==n?$(t).append('<div class="pmml model jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" compid= "'+a+'" id="'+i+'" modelType="'+n+'" souid=""><img class="content-img" src="img/type.manual.png" /><span class="content-text">PMML-Convert</span><div class="proess_bj" style="display:none;"><div class="proess" style="display:none;"><label>执行中</label><div class="proess-show-go"></div></div><div class="proesss" style="display:none;"><div class="proess-show-ok"></div></div></div><div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>'):"maintain"==n?$(t).append('<div class="maintain model jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" compid= "'+a+'" id="'+i+'" modelType="'+n+'" souid=""><img class="content-img" src="img/type.manual.png" /><span class="content-text">Atom-maintain</span></div>'):"writer"==n&&$(t).append('<div class="writer model jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" compid= "'+a+'" id="'+i+'" modelType="'+n+'" souid=""><img class="content-img" src="img/type.send.png" /><span class="content-text">写入 CSV</span></div>');var r=parseInt(e.offset.left-$(t).offset().left+272),s=parseInt(e.offset.top-$(t).offset().top+48);$("#"+i).css("position","absolute").css("left",r).css("top",s),instance.addEndpoint(i,{anchors:"RightMiddle"},hollowCircle),instance.addEndpoint(i,{anchors:"LeftMiddle"},hollowCircle),instance.addEndpoint(i,{anchors:"TopCenter"},hollowCircle),instance.addEndpoint(i,{anchors:"BottomCenter"},hollowCircle),instance.repaintEverything(),$("#"+i).draggable({containment:"parent",drag:function(e,t){instance.repaintEverything()},stop:function(){instance.repaintEverything()}})}function init(e){var t=$("#"+e.sourceId).attr("compid"),a=($("#"+e.targetId).attr("compid"),$("#"+e.targetId).attr("souid"));""==a?$("#"+e.targetId).attr("souid",t):$("#"+e.targetId).attr("souid",a+","+t)}function removeElement(e){var t=$("#"+e);if(confirm("确定删除该模型？")){var a=t.attr("compid"),o=$(document).find(".model").length;console.log(o);for(var i=0;i<o;i++){var n=$(document).find(".model").eq(i).attr("souid");if(console.log($(document).find(".model").eq(i)),console.log(n),void 0==n&&(n=""),-1!=n.indexOf(a)){var r=","+a,s=a+",";if(-1!=n.indexOf(r)&&-1!=n.indexOf(s)){console.log(1);var l=n.replace(","+a,"");$(document).find(".model").eq(i).attr("souid",l)}else if(-1!=n.indexOf(r)&&-1==n.indexOf(s)){console.log(2);var l=n.replace(","+a,"");$(document).find(".model").eq(i).attr("souid",l)}else if(-1==n.indexOf(r)&&-1!=n.indexOf(s)){console.log(3);var l=n.replace(a+",","");$(document).find(".model").eq(i).attr("souid",l)}else if(-1==n.indexOf(r)&&-1==n.indexOf(s)){console.log(4);var l=n.replace(a,"");$(document).find(".model").eq(i).attr("souid",l)}}}instance.remove(t)}}function save(){var e=layer.load(1,{shade:[.4,"#000"]}),t=(instance.getAllConnections(),[]);$.each(instance.getAllConnections(),function(e,a){t.push({ConnectionId:a.id,PageSourceId:a.sourceId,PageTargetId:a.targetId,PageSourceIds:$(a.source).attr("compid"),PageTargetIds:$(a.target).attr("compid"),SourceText:a.source.innerText,TargetText:a.target.innerText,anchors:$.map(a.endpoints,function(e){return[[e.anchor.x,e.anchor.y,e.anchor.orientation[0],e.anchor.orientation[1],e.anchor.offsets[0],e.anchor.offsets[1]]]})})});var a=[];$(".model").each(function(e,t){var o=$(t);a.push({BlockIdd:o.attr("id"),BlockId:o.attr("compid"),BlockType:o.attr("modeltype"),BlockContent:o.html(),BlockX:parseInt(o.css("left"),10),BlockY:parseInt(o.css("top"),10)})});for(var o='{"connects":'+JSON.stringify(t)+',"block":'+JSON.stringify(a)+"}",i=JSON.parse(o),n="",r=[],s=0;s<i.block.length;s++)if("reader"==i.block[s].BlockType){var l=JSON.parse(sessionStorage.getItem(i.block[s].BlockId));if(null==l||"null"==l){var d='<CsvRead componentID="'+i.block[s].BlockId+'" type="'+i.block[s].BlockType+'"><step><props><prop  name="componentID" value="'+i.block[s].BlockId+'"/><prop  name="projectID" value=""/><prop  name="fileName" value=""/><prop  name="tableName" value=""/><prop  name="tableChineseName" value=""/><prop  name="separator" value=""/><prop  name="fileVal" value=""/></props><name>'+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>f6a5fab1dbe5b7db4eb8dba46cdb1b89651bd491</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>,</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></CsvRead>";n+=d}else{var d='<CsvRead componentID="'+i.block[s].BlockId+'" type="'+i.block[s].BlockType+'"><step><props><prop  name="componentID" value="'+i.block[s].BlockId+'"/><prop  name="projectID" value="'+l.data[0].projectID+'"/><prop  name="fileName" value="'+l.data[0].fileName+'"/><prop  name="tableName" value="'+l.data[0].tableName+'"/><prop  name="separator" value="'+l.data[0].separator+'"/><prop  name="fileVal" value="'+l.data[0].fileVal+'"/></props><name>'+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>f6a5fab1dbe5b7db4eb8dba46cdb1b89651bd491</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>,</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></CsvRead>";n+=d}}else if("learn"==i.block[s].BlockType){var l=JSON.parse(sessionStorage.getItem(i.block[s].BlockId));if(null==l||"null"==l){r.push(i.block[s].BlockId);var d='<AtomLearn  componentID="'+i.block[s].BlockId+'"  souid="" type="'+i.block[s].BlockType+'"><step><props><prop  name="componentID" value="'+i.block[s].BlockId+'"/><prop  name="projectID" value=""/><prop name="robotx" value=""/><prop name="data" value=""/><prop name="dict" value=""/><prop  name="commonParameter"><commonparameter  id_varname="" target_varname="" metric="" /></prop><prop  name="preProcessingParameter"><preprocessingparameter  fs_cutoff="" collinearity_cutoff=""  unbalanced_cutoff="" miss_symbols="" discretization=""/></prop><prop  name="algorithmParameter"><algorithmparameter  algorithm="" ntree="" interaction="" shrinkage="" n_minobsinnode=""/></prop></props><name>'+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>null</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>null</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></AtomLearn>";n+=d}else{""==l.data[0].souid&&r.push(i.block[s].BlockId);var c="";"gbm"==l.data[0].algorithm?c='<prop  name="algorithmParameter"><algorithmparameter  algorithm="'+l.data[0].algorithm+'" ntree="'+l.data[0].ntree+'" interaction="'+l.data[0].interaction+'" shrinkage="'+l.data[0].shrinkage+'" n_minobsinnode="'+l.data[0].n_minobsinnode+'"/></prop>':"rf"==l.data[0].algorithm?c='<prop  name="algorithmParameter"><algorithmparameter  algorithm="'+l.data[0].algorithm+'" ntree="'+l.data[0].ntree_rf+'" mtry="'+l.data[0].mtry+'" nodesize="'+l.data[0].nodesize+'" /></prop>':"cart"==l.data[0].algorithm?c='<prop  name="algorithmParameter"><algorithmparameter  algorithm="'+l.data[0].algorithm+'" minsplit="'+l.data[0].minsplit+'" cp="'+l.data[0].cp+'" /></prop>':"xgb"==l.data[0].algorithm?c='<prop  name="algorithmParameter"><algorithmparameter  algorithm="'+l.data[0].algorithm+'" eta="'+l.data[0].eta+'" nrounds="'+l.data[0].nrounds+'" early_stopping_rounds="'+l.data[0].early_stopping_rounds+'" subsample="'+l.data[0].subsample+'"  colsample_bytree="'+l.data[0].colsample_bytree+'" max_depth="'+l.data[0].max_depth+'"  min_child_weight="'+l.data[0].min_child_weight+'" gamma="'+l.data[0].gamma+'" lambda="'+l.data[0].lambda+'" alpha="'+l.data[0].alpha+'" /></prop>':"svm"==l.data[0].algorithm?c='<prop  name="algorithmParameter"><algorithmparameter  algorithm="'+l.data[0].algorithm+'"  gamma="'+l.data[0].svm_gamma+'" C="'+l.data[0].svm_c+'" /></prop>':"naivebayes"==l.data[0].algorithm?c='<prop  name="algorithmParameter"><algorithmparameter  algorithm="'+l.data[0].algorithm+'" /></prop>':"lr"==l.data[0].algorithm?c='<prop  name="algorithmParameter"><algorithmparameter  algorithm="'+l.data[0].algorithm+'" /></prop>':"lasso"==l.data[0].algorithm?c='<prop  name="algorithmParameter"><algorithmparameter  algorithm="'+l.data[0].algorithm+'"  alpha="'+l.data[0].lasso_alpha+'" lambda="'+l.data[0].lasso_lambda+'" /></prop>':"nnet"==l.data[0].algorithm?c='<prop  name="algorithmParameter"><algorithmparameter  algorithm="'+l.data[0].algorithm+'" /></prop>':"adaboost"==l.data[0].algorithm?c='<prop  name="algorithmParameter"><algorithmparameter  algorithm="'+l.data[0].algorithm+'" minsplit="'+l.data[0].minsplit_adaboost+'" cp="'+l.data[0].cp_adaboost+'" iter="'+l.data[0].iter_adaboost+'"  /></prop>':"stacking"==l.data[0].algorithm&&(c='<prop  name="algorithmParameter"><algorithmparameter  algorithm="'+l.data[0].algorithm+'" /></prop>');var d='<AtomLearn  componentID="'+i.block[s].BlockId+'"  souid="'+l.data[0].souid+'" type="'+l.data[0].type+'"><step><props><prop  name="componentID" value="'+i.block[s].BlockId+'"/><prop  name="projectID" value="'+l.data[0].projectID+'"/><prop name="robotx" value=""/><prop name="data" value="'+l.data[0].data+'"/><prop name="dict" value="'+l.data[0].dict+'"/><prop  name="commonParameter"><commonparameter  id_varname="'+l.data[0].id_varname+'" target_varname="'+l.data[0].target_varname+'" metric="'+l.data[0].metric+'" /></prop><prop  name="preProcessingParameter"><preprocessingparameter  fs_cutoff="'+l.data[0].fs_cutoff+'" collinearity_cutoff="'+l.data[0].collinearity_cutoff+'"  unbalanced_cutoff="'+l.data[0].unbalanced_cutoff+'" miss_symbols="'+l.data[0].miss_symbols+'" discretization="'+l.data[0].discretization+'"/></prop>'+c+"</props><name>"+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>null</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>null</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></AtomLearn>";n+=d}}else if("act"==i.block[s].BlockType){var l=JSON.parse(sessionStorage.getItem(i.block[s].BlockId));if(null==l||"null"==l){r.push(i.block[s].BlockId);var d='<AtomAct  componentID="'+i.block[s].BlockId+'" souid="" type="'+i.block[s].BlockType+'"><step><props><prop name="componentID" value="'+i.block[s].BlockId+'"/><prop name="projectID" value=""/><prop name="num_vars" value=""/><prop name="robotx" value=""/> <prop name="data" value=""/><prop name="learn" value=""/></props><name>'+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>null</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>null</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></AtomAct>";n+=d}else{""==l.data[0].souid&&r.push(i.block[s].BlockId);var d='<AtomAct  componentID="'+i.block[s].BlockId+'" souid="'+l.data[0].souid+'" type="'+i.block[s].BlockType+'" ><step><props><prop name="componentID" value="'+i.block[s].BlockId+'"/><prop name="projectID" value="'+l.data[0].projectID+'"/><prop name="num_vars" value="'+l.data[0].data_numvars+'"/><prop name="robotx" value="'+l.data[0].data_robotxcom+'"/> <prop name="data" value="'+l.data[0].data_csvcom+'"/><prop name="learn" value="'+l.data[0].data_learncom+'"/></props><name>'+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>null</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>null</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></AtomAct>";n+=d}}else if("test"==i.block[s].BlockType){var l=JSON.parse(sessionStorage.getItem(i.block[s].BlockId));if(null==l||"null"==l){r.push(i.block[s].BlockId);var d='<AtomTest  componentID="'+i.block[s].BlockId+'" souid="" type="'+i.block[s].BlockType+'"><step><props><prop name="componentID" value="'+i.block[s].BlockId+'"/><prop name="projectID" value=""/><prop name="id_varname" value=""/><prop name="target_varname" value=""/><prop name="act" value=""/> <prop name="data" value=""/><prop name="classification_score" value=""/><prop name="robotx" value=""/></props><name>'+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>null</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>null</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></AtomTest>";n+=d}else{""==l.data[0].souid&&r.push(i.block[s].BlockId);var d='<AtomTest  componentID="'+i.block[s].BlockId+'" souid="'+l.data[0].souid+'" type="'+i.block[s].BlockType+'"><step><props><prop name="componentID" value="'+i.block[s].BlockId+'"/><prop name="projectID" value="'+l.data[0].projectID+'"/><prop name="id_varname" value="'+l.data[0].data_test_id+'"/><prop name="target_varname" value="'+l.data[0].data_test_target+'"/><prop name="act" value="'+l.data[0].data_test_act+'"/> <prop name="data" value="'+l.data[0].data_test_csv+'"/><prop name="classification_score" value="'+l.data[0].classification_score+'"/><prop name="robotx" value="'+l.data[0].data_test_robot+'"/></props><name>'+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>null</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>null</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></AtomTest>";n+=d}}else if("pmml"==i.block[s].BlockType){var l=JSON.parse(sessionStorage.getItem(i.block[s].BlockId));if(null==l||"null"==l){r.push(i.block[s].BlockId);var d='<AtomDeploy  componentID="'+i.block[s].BlockId+'" souid="" type="'+i.block[s].BlockType+'"><step><props><prop name="componentID" value="'+i.block[s].BlockId+'"/><prop name="projectID" value=""/><prop name="learn" value=""/><prop name="modelName" value=""/></props><name>'+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>null</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>null</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></AtomDeploy>";n+=d}else{""==l.data[0].souid&&r.push(i.block[s].BlockId);var d='<AtomDeploy  componentID="'+i.block[s].BlockId+'" souid="'+l.data[0].souid+'" type="'+i.block[s].BlockType+'"><step><props><prop name="componentID" value="'+i.block[s].BlockId+'"/><prop name="projectID" value="'+l.data[0].projectID+'"/><prop name="learn" value="'+l.data[0].learn+'"/><prop name="modelName" value="'+l.data[0].modelName+'"/></props><name>'+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>null</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>null</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></AtomDeploy>";n+=d}}else if("robotx"==i.block[s].BlockType){var l=JSON.parse(sessionStorage.getItem(i.block[s].BlockId));if(null==l||"null"==l){r.push(i.block[s].BlockId);var d='<RobotX  componentID="'+i.block[s].BlockId+'" souid="" type="'+i.block[s].BlockType+'"><step><props><prop  name="componentID" value=""/><prop  name="projectID" value=""/><prop  name="dictOnly" value=""/><prop  name="components"><components  value=""/><components  value=""/></prop><prop name="describe"><field table="" name="" type="" /></prop><prop name="relation"><relation source="" target="" join_source="" join_target="" type="" interval="" /></prop></props><name>'+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>null</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>null</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></RobotX>";n+=d}else{""==l.data[0].souid&&r.push(i.block[s].BlockId);for(var m="",p=l.data[0].souid.split(","),s=0;s<p.length;s++){var u='<components  value="'+p[s]+'"/>';m+=u}var g=sessionStorage.getItem("robotx_one");if(null==g||"null"==g){console.log(456);var d='<RobotX  componentID="'+i.block[s].BlockId+'" souid="'+l.data[0].souid+'" souid="'+l.data[0].souid+'" type="'+i.block[s].BlockType+'"><step><props> <prop  name="componentID" value="'+l.data[0].componentID+'"/><prop  name="projectID" value="'+l.data[0].projectID+'"/><prop  name="dictOnly" value="N"/><prop  name="components">'+m+'</prop><prop name="describe"><field table="" name="" type="" /></prop><prop name="relation"><relation source="" target="" join_source="" join_target="" type="" interval="" /></prop></props><name>'+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>null</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>null</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></RobotX>";n+=d}else{var f=JSON.parse(sessionStorage.getItem("robotx_one")),h=JSON.parse(sessionStorage.getItem("robotx_two")),v="",_="";if(null!=f&&null!=h){for(var b=0;b<f.data[0].data.length;b++){if(console.log(f.data[0].data[b].robot_one_data_text_type),"date"==f.data[0].data[b].robot_one_data_text_type)var y='<field table="'+f.data[0].data[b].name+'" name="'+f.data[0].data[b].robot_one_data_filds_text+'" type="'+f.data[0].data[b].robot_one_data_text_type+'" format="'+f.data[0].data[b].type_name+'"/>';else var y='<field table="'+f.data[0].data[b].name+'" name="'+f.data[0].data[b].robot_one_data_filds_text+'" type="'+f.data[0].data[b].robot_one_data_text_type+'"  />';v+=y}for(var x=0;x<h.robotx_two.length;x++){var k=[];h.robotx_two[x].type,h.robotx_two[x].type;for(var I=0;I<$(h.robotx_two[x].SourceHtml).find(".robot-list-conetnt").length;I++)"1"==$(h.robotx_two[x].SourceHtml).find(".robot-list-conetnt").eq(I).attr("ys")&&k.push($(h.robotx_two[x].SourceHtml).find(".robot-list-conetnt").eq(I).text());for(var w=[],I=0;I<$(h.robotx_two[x].TargetHtml).find(".robot-list-conetnt").length;I++)"1"==$(h.robotx_two[x].TargetHtml).find(".robot-list-conetnt").eq(I).attr("ys")&&w.push($(h.robotx_two[0].TargetHtml).find(".robot-list-conetnt").eq(I).text());var S=h.robotx_two[x].gl_list,B=S.split(",");console.log(w);for(var N=[],D=[],j=0;j<B.length;j++)""==B[j]||(N.push(B[j]),D.push(w[j]));console.log(N),console.log(D);var P='<relation source="'+$(h.robotx_two[x].SourceHtml).find(".robot-list-title").text()+'" target="'+f.data[0].contcaion_name+'" join_source="'+N+'" join_target="'+D+'" type="'+h.robotx_two[x].type+'" interval="'+h.robotx_two[x].type_input+'" />';_+=P}var d='<RobotX  componentID="'+i.block[s].BlockId+'" souid="'+l.data[0].souid+'"  type="'+i.block[s].BlockType+'"><step><props> <prop  name="componentID" value="'+l.data[0].componentID+'"/><prop  name="projectID" value="'+l.data[0].projectID+'"/><prop  name="dictOnly" value="N"/><prop  name="components">'+m+'</prop><prop name="describe">'+v+'</prop><prop name="relation">'+_+"</prop></props><name>"+i.block[s].BlockIdd+"</name><type>"+i.block[s].BlockType+"</type><description/><distribute>Y</distribute><custom_distribution/><copies>1</copies><partitioning><method>none</method><schema_name/></partitioning><filename>null</filename><filename_field/><rownum_field/><include_filename>N</include_filename><separator>null</separator><enclosure>&#x22;</enclosure><header>Y</header><buffer_size>50000</buffer_size><lazy_conversion>Y</lazy_conversion><add_filename_result>N</add_filename_result><parallel>N</parallel><newline_possible>N</newline_possible><encoding/><fields><field><name>field</name><type>String</type><format/><currency/><decimal/><group/><length>-1</length><precision>-1</precision><trim_type>none</trim_type></field></fields><cluster_schema/><remotesteps><input></input><output></output></remotesteps><GUI><xloc>"+i.block[s].BlockX+"</xloc><yloc>"+i.block[s].BlockY+"</yloc><draw></draw></GUI></step></RobotX>";n+=d}}}}console.log(r),console.log(i.connects);for(var s=0;s<i.connects.length;s++){var C="";if(0==r.length)C='<sequenceFlow  id="'+i.connects[s].ConnectionId+'" name="'+i.connects[s].ConnectionId+'" sourceRef="'+i.connects[s].PageSourceId+'"  targetRef="'+i.connects[s].PageTargetId+'"  anchors_1="'+i.connects[s].anchors[0]+'" anchors_2="'+i.connects[s].anchors[1]+'" sourceRefs="'+i.connects[s].PageSourceIds+'" targetRefs="'+i.connects[s].PageTargetIds+'" ></sequenceFlow>';else for(var T=0;T<r.length;T++)if(r[T]!=i.connects[s].PageSourceIds&&r[T]!=i.connects[s].PageTargetIds&&"replace"!=i.connects[s].PageSourceIds&&"replace"!=i.connects[s].PageTargetIds)C='<sequenceFlow  id="'+i.connects[s].ConnectionId+'" name="'+i.connects[s].ConnectionId+'" sourceRef="'+i.connects[s].PageSourceId+'"  targetRef="'+i.connects[s].PageTargetId+'"  anchors_1="'+i.connects[s].anchors[0]+'" anchors_2="'+i.connects[s].anchors[1]+'" sourceRefs="'+i.connects[s].PageSourceIds+'" targetRefs="'+i.connects[s].PageTargetIds+'" ></sequenceFlow>';else{i.connects[s].PageSourceIds="replace",i.connects[s].PageTargetIds="replace";for(var z=0;z<i.connects.length;z++)i.connects[z].PageSourceIds!=r[T]&&i.connects[z].PageTargetIds!=r[T]||(i.connects[z].PageSourceIds="replace",i.connects[z].PageSourceIds="replace")}n+=C}
if(dist_final_xml='<?xml version="1.0" encoding="UTF-8"?><definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="demo_wf_process_def"><process  id="process1492584165209" name="process1492584165209">'+n+"</process></definitions>",$("#data_val").attr("data",n),console.log(dist_final_xml),""==n)return layer.msg("内容为空。"),!1;robotx_xml='{"robotx_one":'+sessionStorage.getItem("robotx_one")+',"robotx_two":'+sessionStorage.getItem("robotx_two")+"}",$.ajax({url:xmlsave,type:"POST",data:{xml:dist_final_xml,projectId:proid,projectName:proname,robotxStr:robotx_xml,userId:userId},success:function(t){layer.close(e),1==going&&layer.alert("保存成功",{icon:1,title:"提示"})}})}function ImplementFn(){save(),$.ajax({type:"post",url:implement,data:{xml:dist_final_xml,projectId:proid,projectName:proname,robotxStr:robotx_xml,userId:userId},success:function(e){if(console.log(e),"SUCCESS"==e.status)layer.alert("任务提交成功！",{icon:1,title:"提示"}),$("#container").children(".model").children(".proess_bj").css("opacity","0.85").css("background","#fff").show(),$("#container").children(".model").children(".proess_bj").children(".proess").show(),$("#container").children(".model").find(".proess_bj").find(".proesss").hide(),$("#container").children(".model").find(".proess_bj").find(".assembly_tab").hide(),setime=setInterval(Timed_Access,1e4);else if("TASK_EXCUTION"==e.status)if("task execution"==e.detail)layer.alert("任务正在执行！",{icon:6,title:"提示"});else{for(var t=JSON.parse(e.detail),a=0;a<t.length;a++)for(var o=0;o<$("#container").find(".model").length;o++)t[a].compId==$("#container").find(".model").eq(o).attr("compid")&&$("#container").find(".model").eq(o).find(".assembly_tab").show();$(".assembly_tab").hover(function(){for(var e="",a=0;a<t.length;a++)t[a].compId==$(this).parent().attr("compid")&&(console.log(t[a].msgList),e=t[a].msgList);layer.tips(e+"为空！",$(this),{tips:[2,"#fff"],time:4e3})},function(){layer.closeAll()})}else layer.alert("任务提交失败！",{icon:6,title:"提示"})},error:function(){layer.msg("接口请求失败")}})}function Timed_Access(){$.ajax({url:Timed_Accesss,type:"get",success:function(e){if(console.log(e),"SUCCESS"==e.status){1==e.detail.instStatus&&layer.confirm("任务执行完毕！",{btn:"确定"},function(){layer.closeAll(),console.log(5),clearInterval(setime)});for(var t=0;t<e.detail.tasks.length;t++)if(console.log(456),11==e.detail.tasks[t].status){console.log(156);for(var a=0;a<$("#container").children(".model").length;a++)e.detail.tasks[t].actId==$("#container").children(".model").eq(a).attr("compid")&&($("#container").children(".model").eq(a).find(".proess_bj").find(".proess").hide(),$("#container").children(".model").eq(a).find(".proess_bj").css({opacity:"1",background:"none"}),$("#container").children(".model").eq(a).find(".proess_bj").find(".proesss").show())}}},error:function(){layer.msg("接口请求失败")}})}function loadJson(){var e=[],t=[],a=[],o="";$.ajax({url:load_xml,type:"post",async:!1,success:function(o){if("SUCCESS"==o.status&&(console.log(o.detail),void 0!=o.detail)){var i=o.detail.robotxJson,o=o.detail.xml,n=JSON.parse(i);sessionStorage.setItem("robotx_one",JSON.stringify(n.robotx_one)),sessionStorage.setItem("robotx_two",JSON.stringify(n.robotx_two)),$(o).find("CsvRead").each(function(){var t=$(this).attr("componentID"),a=$(this).find("name").text(),o=a.substring(0,a.length-5),i=$(this).find("type").text(),n=i.substring(0,i.length-6),r=$(this).find("xloc").text(),s=$(this).find("yloc").text();e.push({BlockIdd:o,BlockId:t,BlockType:n,BlockX:r,BlockY:s})}),$(o).find("AtomLearn").each(function(){var t=$(this).attr("componentID"),a=$(this).attr("souid"),o=$(this).find("name").text(),i=o.substring(0,o.length-5),n=$(this).attr("type"),r=$(this).find("xloc").text(),s=$(this).find("yloc").text();e.push({souid:a,BlockIdd:i,BlockId:t,BlockType:n,BlockX:r,BlockY:s})}),$(o).find("AtomAct").each(function(){var t=$(this).attr("componentID"),a=$(this).attr("souid"),o=$(this).find("name").text(),i=o.substring(0,o.length-5),n=$(this).attr("type"),r=$(this).find("xloc").text(),s=$(this).find("yloc").text();e.push({souid:a,BlockIdd:i,BlockId:t,BlockType:n,BlockX:r,BlockY:s})}),$(o).find("AtomTest").each(function(){var t=$(this).attr("componentID"),a=$(this).attr("souid"),o=$(this).find("name").text(),i=o.substring(0,o.length-5),n=$(this).attr("type"),r=$(this).find("xloc").text(),s=$(this).find("yloc").text();e.push({souid:a,BlockIdd:i,BlockId:t,BlockType:n,BlockX:r,BlockY:s})}),$(o).find("AtomDeploy").each(function(){var t=$(this).attr("componentID"),a=$(this).attr("souid"),o=$(this).find("name").text(),i=o.substring(0,o.length-5),n=$(this).attr("type"),r=$(this).find("xloc").text(),s=$(this).find("yloc").text();e.push({souid:a,BlockIdd:i,BlockId:t,BlockType:n,BlockX:r,BlockY:s})}),$(o).find("RobotX").each(function(){var t=$(this).attr("componentID"),a=$(this).attr("souid"),o=$(this).find("name").text(),i=o.substring(0,o.length-5),n=$(this).attr("type"),r=$(this).find("xloc").text(),s=$(this).find("yloc").text();e.push({souid:a,BlockIdd:i,BlockId:t,BlockType:n,BlockX:r,BlockY:s})}),$(o).find("sequenceFlow").each(function(e){var a=$(this).attr("id"),o=$(this).attr("sourceRef"),i=$(this).attr("targetRef"),n=[[$(this).attr("anchors_1")],[$(this).attr("anchors_2")]];t.push({ConnectionId:a,PageSourceId:o,PageTargetId:i,anchors:n})}),$(o).find("CsvRead").each(function(){var e=$(this).attr("componentID"),t=$(this).find("prop[name='projectID']").attr("value"),o=$(this).find("prop[name='fileName']").attr("value"),i=$(this).find("prop[name='tableName']").attr("value"),n=($(this).find("prop[name='tableChineseName']").attr("value"),$(this).find("prop[name='separator']").attr("value")),r=$(this).find("prop[name='fileVal']").attr("value"),s=$(this).attr("type");a.push({componentID:e,projectID:t,fileName:o,tableName:i,separator:n,fileVal:r,type:s})}),$(o).find("AtomLearn").each(function(){var e=$(this).attr("componentID"),t=$(this).attr("souid"),i=$(this).find("prop[name='projectID']").attr("value"),n=($(this).find("prop[name='separator']").attr("value"),$(this).attr("type")),r=$(this).find("prop[name='data']").attr("value"),s=$(this).find("prop[name='dict']").attr("value"),l=$(this).find("commonparameter").attr("id_varname"),d=$(this).find("commonparameter").attr("target_varname"),c=$(this).find("preprocessingparameter").attr("fs_cutoff"),m=$(this).find("preprocessingparameter").attr("collinearity_cutoff"),p=$(this).find("preProcessingParameter").attr("unbalanced_cutoff"),u=$(this).find("prop[name='preProcessingParameter']").find("preprocessingparameter").attr("miss_symbols");console.log(u);var g=u.split(","),f=$(this).find("prop[name='algorithmParameter']").find("algorithmparameter").attr("algorithm"),h=$(this).find("algorithmparameter").attr("ntree"),v=$(this).find("algorithmparameter").attr("interaction"),_=$(this).find("algorithmparameter").attr("shrinkage"),b=$(this).find("algorithmparameter").attr("n_minobsinnode"),y=$(this).find("prop[name='commonParameter']").find("commonParameter").attr("metric"),x=$(this).find("prop[name='preProcessingParameter']").find("preProcessingParameter").attr("discretization");if("gbm"==f)a.push({componentID:e,projectID:i,type:n,data:r,dict:s,id_varname:l,target_varname:d,algorithm:f,metric:y,discretization:x,fs_cutoff:c,collinearity_cutoff:m,unbalanced_cutoff:p,miss_symbols:g,ntree:h,interaction:v,shrinkage:_,n_minobsinnode:b,souid:t,robotx:""});else if("rf"==f){var h=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("ntree"),k=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("mtry"),I=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("nodesize");a.push({componentID:e,projectID:i,type:n,data:r,souid:t,dict:s,id_varname:l,target_varname:d,algorithm:f,metric:y,discretization:x,fs_cutoff:c,collinearity_cutoff:m,unbalanced_cutoff:p,miss_symbols:g,mtry:k,ntree_rf:h,nodesize:I,robotx:""})}else if("cart"==f){var w=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("minsplit"),S=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("cp");a.push({componentID:e,projectID:i,type:n,data:r,souid:t,dict:s,id_varname:l,target_varname:d,algorithm:f,robotx:"",fs_cutoff:c,collinearity_cutoff:m,unbalanced_cutoff:p,miss_symbols:g,metric:y,discretization:x,minsplit:w,cp:S})}else if("xgb"==f){var B=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("eta"),N=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("nrounds"),D=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("early_stopping_rounds"),j=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("subsample"),P=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("colsample_bytree"),C=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("max_depth"),T=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("min_child_weight"),z=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("gamma");a.push({componentID:e,projectID:i,type:n,data:r,dict:s,id_varname:l,target_varname:d,algorithm:f,robotx:"",souid:t,metric:y,discretization:x,eta:B,nrounds:N,early_stopping_rounds:D,subsample:j,colsample_bytree:P,max_depth:C,min_child_weight:T,gamma:z,collinearity_cutoff:m,unbalanced_cutoff:p,miss_symbols:g})}else if("svm"==f){var O=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("gamma"),Y=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("C");o.push({projectID:i,souid:t,componentID:e,robotx:"",type:"learn",algorithm:f,data:r,dict:s,id_varname:l,target_varname:d,collinearity_cutoff:m,unbalanced_cutoff:p,miss_symbols:g,metric:y,discretization:x,svm_c:O,svm_gamma:Y})}else if("naivebayes"==f)o.push({projectID:i,souid:t,componentID:e,robotx:"",type:"learn",algorithm:f,data:r,dict:s,id_varname:l,target_varname:d,collinearity_cutoff:m,unbalanced_cutoff:p,miss_symbols:g,metric:y,discretization:x});else if("lr"==f)o.push({projectID:i,souid:t,componentID:e,robotx:"",type:"learn",algorithm:f,data:r,dict:s,id_varname:l,target_varname:d,collinearity_cutoff:m,unbalanced_cutoff:p,miss_symbols:g,metric:y,discretization:x});else if("lasso"==f){var A=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("alpha"),J=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("lambda");o.push({projectID:i,souid:t,componentID:e,robotx:"",type:"learn",algorithm:f,data:r,dict:s,id_varname:l,target_varname:d,collinearity_cutoff:m,unbalanced_cutoff:p,miss_symbols:g,metric:y,discretization:x,lasso_alpha:A,lasso_lambda:J})}else if("nnet"==f)o.push({projectID:i,souid:t,componentID:e,robotx:"",type:"learn",algorithm:f,data:r,dict:s,id_varname:l,target_varname:d,collinearity_cutoff:m,unbalanced_cutoff:p,miss_symbols:g,metric:y,discretization:x});else if("adaboost"==f){var R=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("minsplit"),X=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("cp"),E=$(this).find("prop[name='algorithmParameter']").find("algorithmParameter").attr("iter");o.push({projectID:i,souid:t,componentID:e,robotx:"",type:"learn",algorithm:f,data:r,dict:s,id_varname:l,target_varname:d,collinearity_cutoff:m,unbalanced_cutoff:p,miss_symbols:g,metric:y,discretization:x,minsplit_adaboost:R,cp_adaboost:X,iter_adaboost:E})}else"stacking"==f&&o.push({projectID:i,souid:t,componentID:e,robotx:"",type:"learn",algorithm:f,data:r,dict:s,id_varname:l,target_varname:d,collinearity_cutoff:m,unbalanced_cutoff:p,miss_symbols:g,metric:y,discretization:x})}),$(o).find("AtomAct").each(function(){var e=$(this).attr("componentID"),t=$(this).find("prop[name='data']").attr("value"),o=$(this).find("prop[name='learn']").attr("value"),i=$(this).find("prop[name='num_vars']").attr("value"),n=$(this).attr("souid"),r=$(this).find("prop[name='projectID']").attr("value");a.push({componentID:e,projectID:r,type:"act",souid:n,data_robotxcom:"",data_csvcom:t,data_learncom:o,data_numvars:i})}),$(o).find("AtomTest").each(function(){var e=$(this).attr("componentID"),t=$(this).find("prop[name='id_varname']").attr("value"),o=$(this).find("prop[name='target_varname']").attr("value"),i=$(this).find("prop[name='classification_score']").attr("value"),n=$(this).find("prop[name='act']").attr("value"),r=$(this).find("prop[name='data']").attr("value"),s=$(this).attr("souid"),l=$(this).find("prop[name='projectID']").attr("value");a.push({componentID:e,projectID:l,type:"test",souid:s,data_test_robot:"",data_test_id:t,data_test_target:o,classification_score:i,data_test_act:n,data_test_csv:r,data_test_robot:""})}),$(o).find("AtomDeploy").each(function(){var e=$(this).attr("componentID"),t=proid,o=$(this).find("prop[name='learn']").attr("value");console.log(o);var i=$(this).find("prop[name='modelName']").attr("value");a.push({componentID:e,projectID:t,type:"pmml",learn:o,modelName:i,souid:o})}),$(o).find("RobotX").each(function(){var e=$(this).attr("componentID"),t=proid,o=$(this).find("prop[name='filename']").attr("value"),i=$(this).find("prop[name='dictOnly']").attr("value"),n=$(this).attr("souid");a.push({componentID:e,projectID:t,type:"robotx",souid:n,fileName:o,dictOnly:i})})}},error:function(e){layer.msg("接口请求失败")}}),o='{"connects":'+JSON.stringify(t)+',"datas":'+JSON.stringify(a)+' , "block":'+JSON.stringify(e)+"}";var i=JSON.parse(o);if(console.log(i),!i)return!1;if(0==i.block.length)return!1;for(var n=0;n<i.block.length;n++){var r=i.block[n].BlockId,s=i.block[n].BlockIdd,l=i.block[n].BlockX,d=i.block[n].BlockY,c=i.block[n].BlockType,m=i.block[n].souid;if("reader"==c){var p='<div class="model '+c+' jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" style="position:absolute;left:'+l+"px;top:"+d+'px;" id="'+s+'" modeltype="'+c+'"     compid="'+r+'"   ><img class="content-img" src="img/type.service.png"><span class="content-text">CSV 读取</span> <div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>';$("#container").append(p)}else if("learn"==c){var p='<div class="model '+c+' jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" style="position:absolute;left:'+l+"px;top:"+d+'px;" id="'+s+'" modeltype="'+c+'"     compid="'+r+'" souid="'+m+'"  ><img class="content-img" src="img/type.learn.png"><span class="content-text">Atom-learn</span><div class="proess_bj"><div class="proess" style="display:none;"><label>执行中</label><div class="proess-show-go"></div></div><div class="proesss" style="display:none;"><div class="proess-show-ok"></div></div></div> <div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>';$("#container").append(p)}else if("act"==c){var p='<div class="model '+c+' jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable"  style="position:absolute;left:'+l+"px;top:"+d+'px;" id="'+s+'" modeltype="'+c+'"     compid="'+r+'" souid="'+m+'"  ><img class="content-img" src="img/type.act.png"><span class="content-text">Atom-act</span><div class="proess_bj"><div class="proess" style="display:none;"><label>执行中</label><div class="proess-show-go"></div></div><div class="proesss" style="display:none;"><div class="proess-show-ok"></div></div></div><div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>';$("#container").append(p)}else if("test"==c){var p='<div class="model '+c+' jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" style="position:absolute;left:'+l+"px;top:"+d+'px;" id="'+s+'" modeltype="'+c+'"     compid="'+r+'"  souid="'+m+'" ><img class="content-img" src="img/type.test.png"><span class="content-text">Atom-test</span><div class="proess_bj"><div class="proess" style="display:none;"><label>执行中</label><div class="proess-show-go"></div></div><div class="proesss" style="display:none;"><div class="proess-show-ok"></div></div></div><div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>';$("#container").append(p)}else if("pmml"==c){var p='<div class="model '+c+' jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" style="position:absolute;left:'+l+"px;top:"+d+'px;" id="'+s+'" modeltype="'+c+'"     compid="'+r+'"  souid="'+m+'" ><img class="content-img" src="img/type.manual.png"><span class="content-text">PMML-Convert</span><div class="proess_bj" ><div class="proess" style="display:none;"><label>执行中</label><div class="proess-show-go"></div></div><div class="proesss" style="display:none;"><div class="proess-show-ok"></div></div></div><div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>';$("#container").append(p)}else if("robotx"==c){var p='<div class="model '+c+' jtk-endpoint-anchor ui-draggable ui-draggable-handle jtk-connected jtk-draggable" style="position:absolute;left:'+l+"px;top:"+d+'px;" id="'+s+'" modeltype="'+c+'"     compid="'+r+'"  souid="'+m+'" ><img class="content-img" src="img/type.business.rule.png" /><span class="content-text">RobotX</span><div class="proess_bj"><div class="proess" style="display:none;"><label>执行中</label><div class="proess-show-go"></div></div><div class="proesss" style="display:none;"><div class="proess-show-ok"></div></div></div><div class="assembly_tab"><img src="img/icon_fail.png" /></div></div>';$("#container").append(p)}for(var u=!0,g=0;g<i.connects.length;g++){var f=i.connects[g].PageSourceId,h=i.connects[g].PageTargetId;console.log(s),console.log(f),console.log(h),s!=f&&s!=h&&(u=!1)}console.log(i.connects),0==i.connects.length&&(u=!1),console.log(u),0==u&&(instance.addEndpoint(s,{anchors:"TopCenter"},hollowCircle),instance.addEndpoint(s,{anchors:"RightMiddle"},hollowCircle),instance.addEndpoint(s,{anchors:"BottomCenter"},hollowCircle),instance.addEndpoint(s,{anchors:"LeftMiddle"},hollowCircle),instance.repaintEverything(),$("#"+s).draggable({containment:"parent",drag:function(e,t){instance.repaintEverything()},stop:function(){instance.repaintEverything()}}))}for(var g=0;g<i.connects.length;g++){for(var v=[],f=(i.connects[g].ConnectionId,i.connects[g].PageSourceId),h=i.connects[g].PageTargetId,_=i.connects[g],n=0;n<2;n++){var b=_.anchors[n],y=b.join(","),x=y.split(","),k=[];k=x.map(function(e){return+e}),v.push(k)}instance.connect({source:f,target:h,anchors:v,endpoint:["Dot",{radius:4}],connectorStyle:connectorPaintStyle,connectorHoverStyle:connectorHoverStyle,paintStyle:{stroke:"#3cf",strokeWidth:2,outlineColor:"blue",outlineWidth:2},hoverPaintStyle:{stroke:"#f08aa5",strokeWidth:2,outlineColor:"blue",outlineWidth:2},connector:["Flowchart",{stub:30,gap:0,cornerRadius:2,alwaysRespectStubs:!0,midpoint:.5}],maxConnections:10,isSource:!0,isTarget:!0,deleteEndpointsOnDetach:!0}),instance.addEndpoint(f,{anchors:"TopCenter"},hollowCircle),instance.addEndpoint(f,{anchors:"RightMiddle"},hollowCircle),instance.addEndpoint(f,{anchors:"BottomCenter"},hollowCircle),instance.addEndpoint(f,{anchors:"LeftMiddle"},hollowCircle),instance.addEndpoint(h,{anchors:"TopCenter"},hollowCircle),instance.addEndpoint(h,{anchors:"RightMiddle"},hollowCircle),instance.addEndpoint(h,{anchors:"BottomCenter"},hollowCircle),instance.addEndpoint(h,{anchors:"LeftMiddle"},hollowCircle),instance.repaintEverything(),instance.draggable(f),instance.draggable(h),$("#"+f).draggable({containment:"parent"}),$("#"+h).draggable({containment:"parent"})}for(var n=0;n<i.datas.length;n++)sessionStorage.setItem(i.datas[n].componentID,'{"data":['+JSON.stringify(i.datas[n])+"]}");modelCounter=$("#container").children(".model").length}function save_load_gif(e,t){1==t?($(e).append('<img class="save-layer-gif" src="img/save_loading.gif" />'),$(e).text("保存中...")):($(e).remove(".save-layer-gif"),$(e).text("保存"))}var going=!0,robotx_stus=!1,robotx_stuss=!1,robotx_xml="",setime="",connectorPaintStyle={stroke:"#3cf",strokeWidth:2,outlineColor:"blue",outlineWidth:2},connectorHoverStyle={stroke:"#f08aa5",strokeWidth:2,outlineColor:"blue",outlineWidth:2},hollowCircle={endpoint:["Dot",{cssClass:"endpointcssClass"}],connectorStyle:connectorPaintStyle,connectorHoverStyle:connectorHoverStyle,paintStyle:{fill:"#3cf",radius:4},isSource:!0,connector:["Flowchart",{stub:30,gap:0,cornerRadius:2,alwaysRespectStubs:!0,midpoint:.5}],isTarget:!0,maxConnections:-1},xml="",souid=[],modelCounter=0,instance=jsPlumb.getInstance({DragOptions:{cursor:"pointer",zIndex:1e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,width:11,length:11,direction:1,id:"arrow_forwards"}]],Container:"container"});instance.importDefaults({ConnectionsDetachable:!0,ReattachConnections:!0}),$(function(){loadJson();var e=[];$("#container").on("click",".writer",function(){modl_id=$(this).attr("id")}),$("#container").on("click",".reader",function(){modl_id=$(this).attr("id")}),$("#container").on("click",".learn",function(){modl_id=$(this).attr("id")}),$("#container").on("click",".act",function(){modl_id=$(this).attr("id")}),$("#container").on("click",".test",function(){modl_id=$(this).attr("id")}),$("#container").on("click",".maintain",function(){modl_id=$(this).attr("id")}),$("#container").on("click",".robotx",function(){modl_id=$(this).attr("id")}),$("#container").on("click",".pmml",function(){modl_id=$(this).attr("id")}),$("#c-save").click(function(){going=!0;var e=save();$("#data_val").attr("data",e)}),$("#c_dos").click(function(){clearInterval(setime),going=!1,ImplementFn()}),$("#exit_html").click(function(){clearInterval(setime)}),$("#container").on("dblclick",".writer",function(){$("#index_right").html(""),modl_id=$(this).attr("compid"),$("#index_right").load("learn.html",function(){$(".right-main").attr("data",modl_id)})}),$("#container").on("dblclick",".reader",function(){robotx_stus=!0,$("#index_right").html(""),modl_id=$(this).attr("compid"),$("#index_right").load("csvload.html",function(){$(".right-main").attr("data",modl_id);var e=JSON.parse(sessionStorage.getItem(modl_id));null!=e&&"null"!=e&&(""!=e.data[0].fileVal&&($(".img_upload").addClass("c-csv-active").text(e.data[0].fileVal),$(".img_upload").next().show().addClass("c-csv-icon"),$(".files_name").removeClass("img_upload"),$(".c-csv-again").show().addClass("img_upload")),""!=e.data[0].tableName&&$("#reader_enname").val(e.data[0].tableName))})}),$("#container").on("dblclick",".learn",function(){$("#index_right").html(""),modl_id=$(this).attr("compid"),e=$(this).attr("souid");var t=e.split(","),a=sessionStorage.getItem(t[0]);JSON.parse(a);$("#index_right").load("learn.html",function(){$(".right-main").attr("souid",souid),$(".right-main").attr("data",modl_id);var a=sessionStorage.getItem(modl_id),o=JSON.parse(a);if(console.log(o),"null"!=a&&null!=a){var i=sessionStorage.getItem(o.data[0].data),n=sessionStorage.getItem(o.data[0].dict),r=JSON.parse(i),s=JSON.parse(n);console.log(r),console.log(s);var l=r.data[0].tableName,d=r.data[0].projectID,c=r.data[0].componentID,m=r.data[0].separator,p=r.data[0].fileName,u=s.data[0].tableName,g=s.data[0].projectID,f=s.data[0].componentID,h=s.data[0].separator,v=s.data[0].fileName;if($("#c_one_data").text(l).attr("commid",c).attr("filename",p).attr("projectid",d).attr("separator",m).css("color","#858585"),$("#c_data_two").text(u).attr("commid",f).attr("filename",v).attr("projectid",g).attr("separator",h).css("color","#858585"),$("#c_data_learn_id").text(o.data[0].id_varname).css("color","#858585"),$("#c_data_learn_target").text(o.data[0].target_varname).css("color","#858585"),"gbm"==o.data[0].algorithm?o.data[0].algorithm="GBDT":"rf"==o.data[0].algorithm?o.data[0].algorithm="Random Forest":"cart"==o.data[0].algorithm?o.data[0].algorithm="CART":"xgb"==o.data[0].algorithm?o.data[0].algorithm="Xgboost":"svm"==o.data[0].algorithm?o.data[0].algorithm="SVM":"naivebayes"==o.data[0].algorithm?o.data[0].algorithm="Naive Bayes":"lr"==o.data[0].algorithm?o.data[0].algorithm="Logistic Regression":"lasso"==o.data[0].algorithm?o.data[0].algorithm="LASSO":"nnet"==o.data[0].algorithm?o.data[0].algorithm="Neural Network":"adaboost"==o.data[0].algorithm?o.data[0].algorithm="AdaBoost":"stacking"==o.data[0].algorithm&&(o.data[0].algorithm="Stacking"),$("#gbm").text(o.data[0].algorithm).css("color","#858585"),$("#misssymbols").val(o.data[0].fs_cutoff),$("#collinearitycutoff").val(o.data[0].collinearity_cutoff),$("#unbalancedcutoff").val(o.data[0].unbalanced_cutoff),$("#c_data_metric").text(o.data[0].metric),$(".metric-css").find("i").removeClass("metric-i-active"),"rmse"==o.data[0].metric||"rmsle"==o.data[0].metric||"mae"==o.data[0].metric||"gini"==o.data[0].metric?$(".metric-css").eq(1).find("i").addClass("metric-i-active"):$(".metric-css").eq(0).find("i").addClass("metric-i-active"),1==o.data[0].discretization&&$(".discre>i").addClass("metric-i-active"),"GBDT"==o.data[0].algorithm?($("#ntree").val(o.data[0].ntree),$("#interaction").val(o.data[0].interaction),$("#shrinkage").val(o.data[0].shrinkage),$("#n_minobsinnode").val(o.data[0].n_minobsinnode)):"Random Forest"==o.data[0].algorithm?($("#ntree_rf").val(o.data[0].ntree_rf),$("#mtry").val(o.data[0].mtry),$("#nodesize").val(o.data[0].nodesize)):"CART"==o.data[0].algorithm?($("#minsplit").val(o.data[0].minsplit),$("#cp").val(o.data[0].cp)):"Xgboost"==o.data[0].algorithm?($("#eta").val(o.data[0].eta),$("#nrounds").val(o.data[0].nrounds),$("#early_stopping_rounds").val(o.data[0].early_stopping_rounds),$("#subsample").val(o.data[0].subsample),$("#colsample_bytree").val(o.data[0].colsample_bytree),$("#max_depth").val(o.data[0].max_depth),$("#min_child_weight").val(o.data[0].min_child_weight),$("#gamma").val(o.data[0].gamma),$("#lambda").val(o.data[0].lambda),$("#alpha").val(o.data[0].alpha)):"SVM"==o.data[0].algorithm?($("#c").val(o.data[0].svm_c),$("#svm_gamma").val(o.data[0].svm_gamma)):"LASSO"==o.data[0].algorithm?($("#alpha_lasso").val(o.data[0].lasso_alpha),$("#lambda_lasso").val(o.data[0].lasso_lambda)):"AdaBoost"==o.data[0].algorithm&&($("#minsplit_adaboost").val(o.data[0].minsplit_adaboost),$("#cp_adaboost").val(o.data[0].cp_adaboost),$("#iter_adaboost").val(o.data[0].iter_adaboost)),void 0==o.data[0].miss_symbols||"undefined"==o.data[0].miss_symbols||"0"==o.data[0].miss_symbols.length||0==o.data[0].miss_symbols.length);else{var _=o.data[0].miss_symbols;$(".c-learn-miss").remove();for(var b=0;b<_.length;b++){var y='<div class="c-learn-miss"><input type="text" value="'+_[b]+'"><div class="c-add-close"></div></div>';$(".c-learn-newadd").before(y)}}}$(".right-main").attr({data:modl_id,souid:e});for(var b=0;b<t.length;b++){var x=sessionStorage.getItem(t[b]);if("null"!=x&&null!=x){var k=JSON.parse(x),y='<li commid="'+k.data[0].componentID+'" fileName="'+k.data[0].fileName+'" projectID="'+k.data[0].projectID+'" separator="'+k.data[0].separator+'">'+k.data[0].tableName+"</li>";$("#c_learn_data_list").append(y),$("#c_learn_lib_list").append(y)}}var I=$("#c_one_data").attr("commid"),w=$("#c_one_data").attr("projectid"),S=$("#c_one_data").attr("filename"),B=$("#c_one_data").attr("separator");""!=I&&$.ajax({type:"post",url:learn_load_data,data:{projectID:w,componentID:I,fileName:S,separator:B},success:function(e){for(var t=0;t<e.detail.length;t++)$("#c_data_learn_id_list").append("<li>"+e.detail[t].fieldName+"</li>"),$("#c_data_learn_target_list").append("<li>"+e.detail[t].fieldName+"</li>")},error:function(){layer.msg("接口请求失败")}})})}),$("#container").on("dblclick",".act",function(){$("#index_right").html(""),modl_id=$(this).attr("compid");var e=$(this).attr("souid");$("#index_right").load("act.html",function(){$(".right-main").attr("data",modl_id),$(".right-main").attr("souid",e);var t=sessionStorage.getItem(modl_id);if(null!=t){var a=JSON.parse(t);$(".nav-list-act").find("em").text(a.data[0].data_numvars)}})}),$("#container").on("dblclick",".test",function(){$("#index_right").html(""),modl_id=$(this).attr("compid");var e=$(this).attr("souid");$("#index_right").load("test.html",function(){$(".right-main").attr("data",modl_id),$(".right-main").attr("souid",e);var t=sessionStorage.getItem(modl_id),a=JSON.parse(t);null!=a&&($("#c_id_variable").text(a.data[0].data_test_id).css("color","#858585"),$("#target_variable").text(a.data[0].data_test_target).css("color","#858585"),console.log(classification_score),"auto"==a.data[0].classification_score?$("#classification_score").val():$("#classification_score").val(a.data[0].classification_score));var o=e.split(","),i=[];console.log(o);for(var n=0;n<o.length;n++)console.log(sessionStorage.getItem(o[n])),i.push(JSON.parse(sessionStorage.getItem(o[n])).data[0].type);var r="",s="",l=null;console.log(i);for(var n=0;n<i.length;n++)"reader"==i[n]?(r=o[n],l=JSON.parse(sessionStorage.getItem(o[n])).data[0]):"act"==i[n]&&(s=o[n]);$("input[name=csv]").val(r),$("input[name=act]").val(s),$.ajax({type:"post",url:learn_load_data,data:{projectID:l.projectID,componentID:l.componentID,fileName:l.fileName,separator:l.separator},success:function(e){for(var t=0;t<e.detail.length;t++)$("#test_id").append("<li>"+e.detail[t].fieldName+"</li>"),$("#test_target").append("<li>"+e.detail[t].fieldName+"</li>");$(".c_nav_list-test").click(function(){$(this).next().toggle(30)}),$("#test_id li").click(function(){$(this).parent().parent().find("em").text($(this).text()),$(this).parent().parent().find("em").css("color","#858585"),$(this).parent().hide()}),$("#test_target li").click(function(){$(this).parent().parent().find("em").text($(this).text()),$(this).parent().parent().find("em").css("color","#858585"),$(this).parent().hide()})},error:function(){layer.msg("接口请求失败")}})})}),$("#container").on("dblclick",".pmml",function(){$("#index_right").html(""),modl_id=$(this).attr("compid");var e=$(this).attr("souid");$("#index_right").load("pmml.html",function(){$(".right-main").attr("data",modl_id),$(".right-main").attr("souid",e);var t=sessionStorage.getItem(modl_id);if(null!=t){var a=JSON.parse(t);$("#pmml_input").val(a.data[0].modelName)}})}),$("#container").on("dblclick",".robotx",function(){$("#index_right").html(""),modl_id=$(this).attr("compid");var e=$(this).attr("souid");$("#index_right").load("robotx.html",function(){$(".right-main").attr("data",modl_id),$(".right-main").attr("souid",e),$("input[name='componentID']").val(modl_id),$("input[name='projectID']").val(proid);var t=sessionStorage.getItem(modl_id);if(null!=t){var a=JSON.parse(t);console.log(a),"Y"==a.data[0].dictOnly?$("input[name=dictOnly]").attr("checked",!0):$("input[name=dictOnly]").attr("checked",!1),$(".c-robot-flie-upload").text(a.data[0].fileName),$(".c-csv-again").attr("id","img_upload").show(),$(".c-robot-flie-upload").attr("id","").addClass("c-csv-active"),$(".c-robot-flie-upload").next().addClass("c-csv-icon")}})}),$(document).on("contextmenu","div",function(){return!1}),$(document).on("mousedown",".reader",function(e){if(3==e.which){$(".context-menu").remove();var t=$(this).offset().top,a=$(this).offset().left,o=a+70,i=t+40,n=$(this).attr("compid"),r=$(this).attr("modeltype"),s=$(this).attr("id"),l='<div class="context-menu" style="left:'+o+"px; top: "+i+'px; width: 100px; height: 47px; z-index: 3;" compid="'+n+'" type="'+r+'" fatname="'+s+'"><div class="context-menu-item"><div class="context-menu-text">参数</div><div class="context-menu-icon properties-icon"></div></div><div class="context-menu-item"><div class="context-menu-text">删除</div><div class="context-menu-icon icon-remove"></div></div></div>';return $(this).after(l),!1}1==e.which&&$(".context-menu").remove()}),$(document).on("mousedown",".learn",function(e){if(3==e.which){$(".context-menu").remove()
;var t=$(this).offset().top,a=$(this).offset().left,o=a+70,i=t+40,n=$(this).attr("compid"),r=$(this).attr("modeltype"),s=$(this).attr("souid"),l=$(this).attr("id"),d='<div class="context-menu" style="left:'+o+"px; top: "+i+'px; width: 150px; height: 72px; z-index: 3;" compid="'+n+'" type="'+r+'" souid="'+s+'" fatname="'+l+'"><div class="context-menu-item"><div class="context-menu-text">参数</div><div class="context-menu-icon properties-icon"></div></div><div class="context-menu-item"><div class="context-menu-text">删除</div><div class="context-menu-icon icon-remove"></div></div><div class="context-menu-item"><div class="context-menu-text">查看报告</div><div class="context-menu-icon icon-wacth"></div></div></div>';return $(this).after(d),!1}1==e.which&&$(".context-menu").remove()}),$(document).on("mousedown",".act",function(e){if(3==e.which){$(".context-menu").remove();var t=$(this).offset().top,a=$(this).offset().left,o=a+70,i=t+40,n=$(this).attr("compid"),r=$(this).attr("modeltype"),s=$(this).attr("souid"),l=$(this).attr("id"),d='<div class="context-menu" style="left:'+o+"px; top: "+i+'px; width: 150px; height: 72px; z-index: 3;" compid="'+n+'" type="'+r+'" souid="'+s+'" fatname="'+l+'"><div class="context-menu-item"><div class="context-menu-text">参数</div><div class="context-menu-icon properties-icon"></div></div><div class="context-menu-item"><div class="context-menu-text">删除</div><div class="context-menu-icon icon-remove"></div></div><div class="context-menu-item"><div class="context-menu-text">查看报告</div><div class="context-menu-icon icon-wacth"></div></div></div>';return $(this).after(d),!1}1==e.which&&$(".context-menu").remove()}),$(document).on("mousedown",".test",function(e){if(3==e.which){$(".context-menu").remove();var t=$(this).offset().top,a=$(this).offset().left,o=a+70,i=t+40,n=$(this).attr("compid"),r=$(this).attr("modeltype"),s=$(this).attr("souid"),l=$(this).attr("id"),d='<div class="context-menu" style="left:'+o+"px; top: "+i+'px; width: 150px; height: 72px; z-index: 3;" compid="'+n+'" type="'+r+'" souid="'+s+'" fatname="'+l+'"><div class="context-menu-item"><div class="context-menu-text">参数</div><div class="context-menu-icon properties-icon"></div></div><div class="context-menu-item"><div class="context-menu-text">删除</div><div class="context-menu-icon icon-remove"></div></div><div class="context-menu-item"><div class="context-menu-text">查看报告</div><div class="context-menu-icon icon-wacth"></div></div></div>';return $(this).after(d),!1}1==e.which&&$(".context-menu").remove()}),$(document).on("mousedown",".pmml",function(e){if(3==e.which){$(".context-menu").remove();var t=$(this).offset().top,a=$(this).offset().left,o=a+70,i=t+40,n=$(this).attr("compid"),r=$(this).attr("modeltype"),s=$(this).attr("souid"),l=$(this).attr("id"),d='<div class="context-menu" style="left:'+o+"px; top: "+i+'px; width: 150px; height: 72px; z-index: 3;" compid="'+n+'" type="'+r+'" souid="'+s+'" fatname="'+l+'"><div class="context-menu-item"><div class="context-menu-text">参数</div><div class="context-menu-icon properties-icon"></div></div><div class="context-menu-item"><div class="context-menu-text">删除</div><div class="context-menu-icon icon-remove"></div></div><div class="context-menu-item"><div class="context-menu-text">查看报告</div><div class="context-menu-icon icon-wacth"></div></div></div>';return $(this).after(d),!1}1==e.which&&$(".context-menu").remove()}),$(document).on("mousedown",".robotx",function(e){if(3==e.which){$(".context-menu").remove();var t=$(this).offset().top,a=$(this).offset().left,o=a+70,i=t+40,n=$(this).attr("compid"),r=$(this).attr("modeltype"),s=$(this).attr("souid"),l=$(this).attr("id"),d='<div class="context-menu" style="left:'+o+"px; top: "+i+'px; width: 150px; height: 72px; z-index: 3;" compid="'+n+'" type="'+r+'" souid="'+s+'" fatname="'+l+'"><div class="context-menu-item"><div class="context-menu-text">参数</div><div class="context-menu-icon properties-icon"></div></div><div class="context-menu-item"><div class="context-menu-text">删除</div><div class="context-menu-icon icon-remove"></div></div><div class="context-menu-item"><div class="context-menu-text">下载</div><div class="context-menu-icon icon-wacth"></div></div></div>';return $(this).after(d),!1}1==e.which&&$(".context-menu").remove()}),$(document).mousedown(function(e){3==e.which?$(".context-menu").remove():e.which}),$(document).on("click",".context-menu-item",function(){var e=$(this).parent().attr("type"),t=$(this).parent().attr("compid"),a=$(this).parent().attr("souid"),o=$(this).parent().attr("fatname");if("参数"==$(this).find(".context-menu-text").text())if("reader"==e){$("#index_right").html("");var i=t;$("#index_right").load("csvload.html",function(){$(".right-main").attr("data",i);var e=JSON.parse(sessionStorage.getItem(i));null!=e&&"null"!=e&&(""!=e.data[0].fileVal&&($(".img_upload").addClass("c-csv-active").text(e.data[0].fileVal),$(".img_upload").next().show().addClass("c-csv-icon"),$(".files_name").removeClass("img_upload"),$(".c-csv-again").show().addClass("img_upload")),""!=e.data[0].tableName&&$("#reader_enname").val(e.data[0].tableName))}),$(".context-menu").remove()}else if("learn"==e){$("#index_right").html("");var n=a,r=n.split(","),s=sessionStorage.getItem(r[0]);JSON.parse(s);$("#index_right").load("learn.html",function(){var e=sessionStorage.getItem(t),a=JSON.parse(e);if("null"!=e&&null!=e){var o=sessionStorage.getItem(a.data[0].data),i=sessionStorage.getItem(a.data[0].dict),s=JSON.parse(o),l=JSON.parse(i),d=s.data[0].tableChineseName,c=s.data[0].projectID,m=s.data[0].componentID,p=s.data[0].separator,u=s.data[0].fileName,g=l.data[0].tableChineseName,f=l.data[0].projectID,h=l.data[0].componentID,v=l.data[0].separator,_=l.data[0].fileName;if($("#c_one_data").text(d).attr("commid",m).attr("filename",u).attr("projectid",c).attr("separator",p).css("color","#858585"),$("#c_data_two").text(g).attr("commid",h).attr("filename",_).attr("projectid",f).attr("separator",v).css("color","#858585"),$("#c_data_learn_id").text(a.data[0].id_varname).css("color","#858585"),$("#c_data_learn_target").text(a.data[0].target_varname).css("color","#858585"),$("#gbm").text(a.data[0].algorithm).css("color","#858585"),$("#misssymbols").val(a.data[0].fs_cutoff),$("#collinearitycutoff").val(a.data[0].collinearity_cutoff),$("#unbalancedcutoff").val(a.data[0].unbalanced_cutoff),$("#c_data_metric").text(a.data[0].metric),$(".metric-css").find("i").removeClass("metric-i-active"),"rmse"==a.data[0].metric||"rmsle"==a.data[0].metric||"mae"==a.data[0].metric||"gini"==a.data[0].metric?$(".metric-css").eq(1).find("i").addClass("metric-i-active"):$(".metric-css").eq(0).find("i").addClass("metric-i-active"),1==a.data[0].discretization&&$(".discre>i").addClass("metric-i-active"),"gbm"==a.data[0].algorithm?($("#ntree").val(a.data[0].ntree),$("#interaction").val(a.data[0].interaction),$("#shrinkage").val(a.data[0].shrinkage),$("#n_minobsinnode").val(a.data[0].n_minobsinnode)):"rf"==a.data[0].algorithm?($("#ntree_rf").val(a.data[0].ntree_rf),$("#mtry").val(a.data[0].mtry),$("#nodesize").val(a.data[0].nodesize)):"cart"==a.data[0].algorithm?($("#minsplit").val(a.data[0].minsplit),$("#cp").val(a.data[0].cp)):"xbg"==a.data[0].algorithm?($("#eta").val(a.data[0].eta),$("#nrounds").val(a.data[0].nrounds),$("#early_stopping_rounds").val(a.data[0].early_stopping_rounds),$("#subsample").val(a.data[0].subsample),$("#colsample_bytree").val(a.data[0].colsample_bytree),$("#max_depth").val(a.data[0].max_depth),$("#min_child_weight").val(a.data[0].min_child_weight),$("#gamma").val(a.data[0].gamma),$("#lambda").val(a.data[0].lambda),$("#alpha").val(a.data[0].alpha)):"svm"==a.data[0].algorithm?($("#c").val(a.data[0].svm_c),$("#svm_gamma").val(a.data[0].svm_gamma)):"lasso"==a.data[0].algorithm?($("#alpha_lasso").val(a.data[0].lasso_alpha),$("#lambda_lasso").val(a.data[0].lasso_lambda)):"adaboost"==a.data[0].algorithm&&($("#minsplit_adaboost").val(a.data[0].minsplit_adaboost),$("#cp_adaboost").val(a.data[0].cp_adaboost),$("#iter_adaboost").val(a.data[0].iter_adaboost)),void 0==a.data[0].miss_symbols||"undefined"==a.data[0].miss_symbols||"0"==a.data[0].miss_symbols.length||0==a.data[0].miss_symbols.length);else{var b=a.data[0].miss_symbols.split(",");$(".c-learn-miss").remove();for(var y=0;y<b.length;y++){var x='<div class="c-learn-miss"><input type="text" value="'+b[y]+'"><div class="c-add-close"></div></div>';$(".c-learn-newadd").before(x)}}$("#interaction").val(a.data[0].interaction),$("#shrinkage").val(a.data[0].shrinkage),$("#n_minobsinnode").val(a.data[0].n_minobsinnode)}$(".right-main").attr({data:t,souid:n});for(var y=0;y<r.length;y++){var k=sessionStorage.getItem(r[y]);if("null"!=k&&null!=k){var I=JSON.parse(k),x='<li commid="'+I.data[0].componentID+'" fileName="'+I.data[0].fileName+'" projectID="'+I.data[0].projectID+'" separator="'+I.data[0].separator+'">'+I.data[0].tableName+"</li>";$("#c_learn_data_list").append(x),$("#c_learn_lib_list").append(x)}}var w=$("#c_one_data").attr("commid"),S=$("#c_one_data").attr("projectid"),B=$("#c_one_data").attr("filename"),N=$("#c_one_data").attr("separator");""!=w&&$.ajax({type:"post",url:learn_load_data,data:{projectID:S,componentID:w,fileName:B,separator:N},success:function(e){console.log(e);for(var t=0;t<e.detail.length;t++)$("#c_data_learn_id_list").append("<li>"+e.detail[t].fieldName+"</li>"),$("#c_data_learn_target_list").append("<li>"+e.detail[t].fieldName+"</li>")},error:function(){layer.msg("接口请求失败")}})}),$(".context-menu").remove()}else"act"==e?($("#index_right").html(""),$("#index_right").load("act.html",function(){$(".right-main").attr("data",t),$(".right-main").attr("souid",a);var e=sessionStorage.getItem(t);if(null!=e){var o=JSON.parse(e);$(".nav-list-act").find("em").text(o.data[0].data_numvars)}}),$(".context-menu").remove()):"test"==e?($("#index_right").html(""),$("#index_right").load("test.html",function(){$(".right-main").attr("data",t),$(".right-main").attr("souid",a);var e=sessionStorage.getItem(t),o=JSON.parse(e);null!=o&&($("#c_id_variable").text(o.data[0].data_test_id).css("color","#858585"),$("#target_variable").text(o.data[0].data_test_target).css("color","#858585"),"auto"==o.data[0].classification_score?$("#classification_score").val():$("#classification_score").val(o.data[0].classification_score));var i=a.split(","),n=[];console.log(i);for(var r=0;r<i.length;r++)console.log(sessionStorage.getItem(i[r])),n.push(JSON.parse(sessionStorage.getItem(i[r])).data[0].type);var s="",l="",d=null;console.log(n);for(var r=0;r<n.length;r++)console.log(),"reader"==n[r]?(s=i[r],d=JSON.parse(sessionStorage.getItem(i[r])).data[0]):"act"==n[r]&&(l=i[r]);$("input[name=csv]").val(s),$("input[name=act]").val(l),$.ajax({type:"post",url:learn_load_data,data:{projectID:d.projectID,componentID:d.componentID,fileName:d.fileName,separator:d.separator},success:function(e){console.log(e);for(var t=0;t<e.detail.length;t++)$("#test_id").append("<li>"+e.detail[t].fieldName+"</li>"),$("#test_target").append("<li>"+e.detail[t].fieldName+"</li>");$(".c_nav_list-test").click(function(){$(this).next().toggle(30)}),$("#test_id li").click(function(){$(this).parent().parent().find("em").text($(this).text()),$(this).parent().parent().find("em").css("color","#858585"),$(this).parent().hide()}),$("#test_target li").click(function(){$(this).parent().parent().find("em").text($(this).text()),$(this).parent().parent().find("em").css("color","#858585"),$(this).parent().hide()})},error:function(){layer.msg("接口请求失败")}})}),$(".context-menu").remove()):"pmml"==e?($("#index_right").html(""),$("#index_right").load("pmml.html",function(){$(".right-main").attr("data",t),$(".right-main").attr("souid",a);var e=sessionStorage.getItem(t);if(null!=e){var o=JSON.parse(e);$("#pmml_input").val(o.data[0].modelName)}}),$(".context-menu").remove()):"robotx"==e&&($("#index_right").html(""),$("#index_right").load("robotx.html",function(){$(".right-main").attr("data",t),$(".right-main").attr("souid",a),$("input[name='componentID']").val(i),$("input[name='projectID']").val(proid);var e=sessionStorage.getItem(t);if(null!=e){"Y"==JSON.parse(e).data[0].dictOnly?$("input[name=dictOnly]").attr("checked",!0):$("input[name=dictOnly]").attr("checked",!1)}}),$(".context-menu").remove());else if("删除"==$(this).find(".context-menu-text").text()){var i=o;removeElement(i),$(".context-menu").remove()}else"查看报告"==$(this).find(".context-menu-text").text()?$.ajax({type:"post",url:view_report,data:{projectID:proid,componentID:t},success:function(e){$(".context-menu").remove(),"SUCCESS"==e.status?window.open(server+"/report/view?projectID="+proid+"&componentID="+t):layer.alert("文件生成中,请稍后...",{icon:1,title:"提示"})},error:function(){$(".context-menu").remove(),layer.msg("接口请求失败")}}):"下载"==$(this).find(".context-menu-text").text()&&($(".context-menu").remove(),window.open(robotXdwon_ajax+"?projectID="+proid+"&componentID="+t))})}),$(document).keydown(function(e){46==e.keyCode&&removeElement(modl_id)});